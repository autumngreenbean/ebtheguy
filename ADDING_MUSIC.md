# How to Add New Music CDs via Google Sheets

This guide explains how to add new album/CD players to your website through Google Sheets.

## ⚠️ ONE-TIME SETUP REQUIRED

**Before adding albums, you MUST update your Google Apps Script once:**

1. Open your Google Sheet
2. Go to **Extensions > Apps Script**
3. Replace the existing code with the updated `Code.gs` from `/google-apps/Code.gs` in this repo
4. **Save** the script (Ctrl+S or Cmd+S)
5. Close the Apps Script editor

**This adds support for the new "Apple Album ID" column.**

You only need to do this once! After that, adding new CDs is automatic.

---

## Quick Overview

The website **automatically fetches music data** from `data/content.json`, which is updated by your Google Sheets. When you add albums in the sheet:

1. ✅ **CD icons appear automatically** on the desktop
2. ✅ **Track data is fetched** from Apple Music using album IDs
3. ✅ **Everything updates** within 5-10 minutes

No code changes needed - just update the Google Sheet!

## Step-by-Step Guide

### 1. Find Your Apple Music Album ID

To get reliable track playback, you need the Apple Music album ID:

1. Go to the album on Apple Music (web or app)
2. Copy the album URL. It will look like:
   ```
   https://music.apple.com/us/album/album-name/1234567890
   ```
3. The number at the end (`1234567890`) is your album ID

**Example:**
- URL: `https://music.apple.com/us/album/code-grėėn-feat-prod-eb-ep/1715533205`
- Album ID: `1715533205`

### 2. Add Album to Google Sheets

In your Google Sheet, add a new row in the **Music** sheet with these columns:

| artist | title | displayName | icon | positionTop | positionRight | appleAlbumId |
|--------|-------|-------------|------|-------------|---------------|--------------|
| Artist Name | Full Album Title | Short-Name.wav | cd.png | 0.3 | 0.4 | 1234567890 |

**Column Explanations:**

- **artist**: The artist/band name (must match exactly as it appears on Apple Music)
- **title**: The full album title (exactly as it appears on Apple Music)
- **displayName**: The short name shown under the CD icon (e.g., "Album-Name.wav")
- **icon**: Always use `cd.png` (the CD icon)
- **positionTop**: Vertical position on screen (0.0 = top, 1.0 = bottom)
- **positionRight**: Horizontal position (0.0 = left, 1.0 = right)
- **appleAlbumId**: The album ID from Apple Music (IMPORTANT for reliable playback!)

**Example Rows:**

```
artist: Lokadonna
title: code:GRĖĖN (feat. Prod.eb) - EP
displayName: code:GREEN.wav
icon: cd.png
positionTop: 0.2
positionRight: 0.2
appleAlbumId: 1715533205

artist: tsunamë
title: 99 Side A
displayName: 99 Side A.wav
icon: cd.png
positionTop: 0.5
positionRight: 0.5
appleAlbumId: 1527805750
```

### 3. How It Works

Once you save your Google Sheet:

1. The sheet automatically updates `data/content.json` via GitHub API (within ~1 minute)
2. The website reads the updated JSON file (cached for 5 minutes)
3. **CD icons are dynamically generated** on the desktop from the JSON data
4. The album ID is loaded into the player for that CD
5. When users click the CD, tracks are fetched using the Apple Music Lookup API
6. The player displays tracks and allows playback of 30-second previews

**You never need to edit HTML code!** Everything is driven by the Google Sheet.

### 4. Why Album IDs Are Important

**With Album ID** ✅
- Reliable track fetching
- Works with special characters (Ė, ë, etc.)
- Faster loading
- No search ambiguity

**Without Album ID** ⚠️
- Falls back to text search
- May fail with special characters
- Slower and less reliable
- May not find the correct album

### 5. Troubleshooting

**Tracks not loading?**
- Verify the Apple Music album ID is correct
- Check that the artist name matches exactly
- Make sure the album is available in the US iTunes Store

**CD not appearing?**
- Check your Google Sheet column names match exactly
- Wait 5-10 minutes for the JSON file to update
- Clear browser cache and refresh

**Special characters not working?**
- Always include the `appleAlbumId` - this bypasses character encoding issues
- The album ID method is immune to special character problems

## Technical Details

### How Album IDs Are Used

1. When the page loads, `selector.js` fetches all music data from `content.json`
2. It builds a map of album titles → album IDs
3. When a CD is clicked, it looks up the album ID
4. If an ID exists, it uses: `https://itunes.apple.com/lookup?id={albumId}&entity=song`
5. If no ID, it falls back to: `https://itunes.apple.com/search?term={album}+{artist}&entity=musicTrack`

### Files Involved

- `data/content.json` - Generated by Google Sheets, contains album data
- `modules/generateCDs.js` - **Dynamically creates CD icons from JSON data**
- `modules/selector.js` - Loads album IDs and fetches tracks
- `modules/data-service.js` - Provides fallback data if JSON fails
- `index.html` - No longer contains hardcoded CDs (fully dynamic!)
- Google Sheets → GitHub API → `content.json` (automated pipeline)

## Best Practices

1. ✅ Always include `appleAlbumId` for new albums
2. ✅ Test album URLs in Apple Music before adding
3. ✅ Use descriptive but short displayNames (e.g., "Album-Name.wav")
4. ✅ Space out CD positions so they don't overlap
5. ✅ Use artist names exactly as they appear on Apple Music

## Example: Adding a New Album

Let's say you want to add "My New Album" by "Artist Name":

1. **Find the Apple Music URL:**
   ```
   https://music.apple.com/us/album/my-new-album/9876543210
   ```
   Album ID: `9876543210`

2. **Add to Google Sheet:**
   ```
   artist: Artist Name
   title: My New Album
   displayName: New-Album.wav
   icon: cd.png
   positionTop: 0.6
   positionRight: 0.3
   appleAlbumId: 9876543210
   ```

3. **Save and wait** 5-10 minutes for the update

4. **Refresh your website** - the new CD should appear automatically on the desktop!

5. **No HTML editing needed** - the CD icon is generated from the JSON data

---

**Need Help?** Check the browser console (F12 → Console) for error messages. The system logs which albums are loaded and whether it's using album IDs or search.
